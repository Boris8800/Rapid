# Shared SSL params (Mozilla modern-ish defaults)
ssl_protocols TLSv1.2 TLSv1.3;
ssl_prefer_server_ciphers off;

ssl_session_timeout 1d;
ssl_session_cache shared:SSL:10m;
ssl_session_tickets off;

# Enable OCSP stapling
ssl_stapling on;
ssl_stapling_verify on;
resolver 1.1.1.1 8.8.8.8 valid=300s;
resolver_timeout 5s;

# Strong curves
ssl_ecdh_curve X25519:secp384r1;

# DH params (generated on server; stored in LetsEncrypt volume)
ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

# HSTS (A+ requires preload only if you submit; we still enable includeSubDomains)
add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;

# Security headers
add_header X-XSS-Protection "1; mode=block" always;
add_header Cross-Origin-Opener-Policy "same-origin" always;
add_header Cross-Origin-Resource-Policy "same-site" always;
add_header X-Permitted-Cross-Domain-Policies "none" always;

# Reasonable CSP baseline (tighten once you know all third-party origins)
add_header Content-Security-Policy "default-src 'self' https: data: blob:; script-src 'self' https: 'unsafe-inline' 'unsafe-eval'; style-src 'self' https: 'unsafe-inline'; img-src 'self' https: data: blob:; connect-src 'self' https: wss:; font-src 'self' https: data:; frame-ancestors 'self'; base-uri 'self';" always;
